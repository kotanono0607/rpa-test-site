<!-- levels.html - ãŠé¡Œã‚¯ãƒªã‚¢ãƒ¢ãƒ¼ãƒ‰ï¼ˆRPAãƒ„ãƒ¼ãƒ«æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆï¼‰Ver.2.0 -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãŠé¡Œã‚¯ãƒªã‚¢ãƒ¢ãƒ¼ãƒ‰ - RPA ãƒ†ã‚¹ãƒˆã‚µã‚¤ãƒˆ</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    .level-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .level-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border: 3px solid var(--border);
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    .level-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    .level-card.locked {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .level-card.cleared {
      border-color: var(--success);
      background: linear-gradient(135deg, #f0fdf4, #dcfce7);
    }
    .level-card.current {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2);
    }
    .level-number {
      position: absolute;
      top: -12px;
      left: -12px;
      width: 40px;
      height: 40px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2rem;
    }
    .level-card.cleared .level-number {
      background: var(--success);
    }
    .level-card.locked .level-number {
      background: var(--secondary);
    }
    .level-title {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 8px;
      padding-left: 20px;
    }
    .level-desc {
      color: var(--secondary);
      font-size: 0.9rem;
      margin-bottom: 12px;
    }
    .level-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
    }
    .level-status .stars {
      color: #fbbf24;
    }
    .level-status .locked-text {
      color: var(--secondary);
    }
    .level-status .cleared-text {
      color: var(--success);
      font-weight: bold;
    }
    .level-arena {
      background: white;
      border-radius: 12px;
      padding: 24px;
      min-height: 400px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .level-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border);
    }
    .level-header h2 {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .level-header .level-badge {
      background: var(--primary);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
    }
    .mission-box {
      background: linear-gradient(135deg, #eff6ff, #dbeafe);
      padding: 16px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid var(--primary);
    }
    .mission-box h3 {
      margin-bottom: 8px;
      color: var(--primary);
    }
    .level-content {
      padding: 20px;
      background: var(--light);
      border-radius: 8px;
      min-height: 200px;
    }
    .level-actions {
      margin-top: 20px;
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .progress-bar-container {
      background: var(--border);
      border-radius: 10px;
      height: 20px;
      overflow: hidden;
      margin-bottom: 24px;
    }
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--success), #34d399);
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.75rem;
      font-weight: bold;
    }
    .celebration {
      text-align: center;
      padding: 40px;
      animation: celebrate 0.5s ease;
    }
    @keyframes celebrate {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    .celebration h2 {
      font-size: 2rem;
      color: var(--success);
      margin-bottom: 16px;
    }
    .celebration .stars {
      font-size: 3rem;
      margin-bottom: 16px;
    }

    /* ç¸¦é•·ãƒ¬ãƒ™ãƒ«é€²æ—ãƒãƒ¼ï¼ˆ20ãƒ¬ãƒ™ãƒ«å¯¾å¿œï¼‰ */
    .level-sidebar {
      position: fixed;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: white;
      border-radius: 20px;
      padding: 12px 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: center;
      max-height: 90vh;
      overflow-y: auto;
    }
    .level-sidebar::-webkit-scrollbar { width: 0; }
    .level-dot {
      width: 28px;
      height: 28px;
      min-height: 28px;
      border-radius: 50%;
      background: var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.7rem;
      color: var(--secondary);
      cursor: pointer;
      transition: all 0.2s ease;
      border: 2px solid transparent;
    }
    .level-dot:hover {
      transform: scale(1.2);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .level-dot.cleared {
      background: var(--success);
      color: white;
      border-color: #059669;
    }
    .level-dot.current {
      background: var(--primary);
      color: white;
      border-color: #1d4ed8;
      animation: pulse 2s infinite;
    }
    .level-dot.locked {
      background: #e5e7eb;
      color: #9ca3af;
      cursor: not-allowed;
    }
    .level-dot.locked:hover {
      transform: none;
      box-shadow: none;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(37, 99, 235, 0); }
    }
    .level-sidebar-progress {
      width: 8px;
      height: 100px;
      background: var(--border);
      border-radius: 4px;
      margin-top: 8px;
      overflow: hidden;
      position: relative;
    }
    .level-sidebar-progress-fill {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, var(--success), #34d399);
      transition: height 0.5s ease;
    }
    .level-sidebar-percent {
      font-size: 0.75rem;
      font-weight: bold;
      color: var(--success);
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <a href="index.html" class="logo">RPA ãƒ†ã‚¹ãƒˆã‚µã‚¤ãƒˆ</a>
      <nav>
        <ul>
          <li><a href="index.html">ãƒˆãƒƒãƒ—</a></li>
          <li><a href="form.html">å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ </a></li>
          <li><a href="click.html">ã‚¯ãƒªãƒƒã‚¯</a></li>
          <li><a href="keyboard.html">ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰</a></li>
          <li><a href="wait.html">å¾…æ©Ÿ</a></li>
          <li><a href="table.html">ãƒ†ãƒ¼ãƒ–ãƒ«</a></li>
          <li><a href="popup.html">ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—</a></li>
          <li><a href="dynamic.html">å‹•çš„</a></li>
          <li><a href="advanced.html">é«˜åº¦</a></li>
          <li><a href="challenge.html">æŒ‘æˆ¦</a></li>
          <li><a href="levels.html" class="active">ãƒ¬ãƒ™ãƒ«</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <h1 class="page-title">ğŸ¯ ãŠé¡Œã‚¯ãƒªã‚¢ãƒ¢ãƒ¼ãƒ‰</h1>
      <p class="page-description">RPAãƒ„ãƒ¼ãƒ«ã®æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆç”¨ã‚µã‚¤ãƒˆã€‚20ã®ãŠé¡Œã‚’ã‚¯ãƒªã‚¢ã—ã¦ã€ãƒ„ãƒ¼ãƒ«ã®å‹•ä½œã‚’æ¤œè¨¼ã—ã‚ˆã†ï¼</p>

      <!-- é€²æ—ãƒãƒ¼ -->
      <div class="progress-bar-container">
        <div class="progress-bar-fill" id="total-progress" style="width: 0%;">0%</div>
      </div>

      <!-- ãƒ¬ãƒ™ãƒ«ä¸€è¦§ -->
      <div class="level-grid" id="level-grid">
        <!-- JavaScriptã§ç”Ÿæˆ -->
      </div>

      <!-- ãƒ¬ãƒ™ãƒ«ãƒ—ãƒ¬ã‚¤ã‚¨ãƒªã‚¢ -->
      <div class="level-arena" id="level-arena">
        <div style="text-align: center; padding: 60px; color: var(--secondary);">
          <p style="font-size: 1.2rem;">ä¸Šã‹ã‚‰ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
        </div>
      </div>

      <!-- æ“ä½œãƒ­ã‚° -->
      <div class="card" style="margin-top: 24px;">
        <div class="card-title">ğŸ“œ æ“ä½œãƒ­ã‚°</div>
        <div id="level-log" class="log-area">
          <div class="log-entry"><span class="log-time">[--:--:--]</span>ãƒ¬ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ‰ã¸ã‚ˆã†ã“ãï¼</div>
        </div>
      </div>
    </div>
  </main>

  <!-- ç¸¦é•·ãƒ¬ãƒ™ãƒ«é€²æ—ãƒãƒ¼ï¼ˆå³ã‚µã‚¤ãƒ‰ï¼‰ -->
  <div class="level-sidebar" id="level-sidebar">
    <!-- JavaScriptã§ç”Ÿæˆ -->
  </div>

  <footer>
    <p>RPA Test Site for UIpowershell - Created for automation testing</p>
  </footer>

  <script src="script.js"></script>
  <script>
    // ãƒ¬ãƒ™ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆ20ãƒ¬ãƒ™ãƒ«ï¼‰
    const levels = [
      // ===== å…¥é–€ï¼ˆ1-5ï¼‰ =====
      {
        id: 1, title: 'ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯', category: 'å…¥é–€',
        desc: 'ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã¿ã‚ˆã†',
        mission: 'ã€Œã‚¯ãƒªãƒƒã‚¯ï¼ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„',
        type: 'click'
      },
      {
        id: 2, title: 'ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›', category: 'å…¥é–€',
        desc: 'å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æ–‡å­—ã‚’å…¥åŠ›ã—ã‚ˆã†',
        mission: 'å…¥åŠ›æ¬„ã«ã€ŒRPAã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„',
        type: 'input', answer: 'RPA'
      },
      {
        id: 3, title: 'ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é¸æŠ', category: 'å…¥é–€',
        desc: 'ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰é¸æŠã—ã‚ˆã†',
        mission: 'ã€Œæ±äº¬éƒ½ã€ã‚’é¸æŠã—ã¦ãã ã•ã„',
        type: 'select', answer: 'tokyo'
      },
      {
        id: 4, title: 'ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹', category: 'å…¥é–€',
        desc: 'ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ONã«ã—ã‚ˆã†',
        mission: 'ã€ŒåŒæ„ã™ã‚‹ã€ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„',
        type: 'checkbox'
      },
      {
        id: 5, title: 'ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³', category: 'å…¥é–€',
        desc: 'é¸æŠè‚¢ã‹ã‚‰1ã¤é¸ã¼ã†',
        mission: 'ã€Œã‚ªãƒ—ã‚·ãƒ§ãƒ³Bã€ã‚’é¸æŠã—ã¦ãã ã•ã„',
        type: 'radio', answer: 'b'
      },
      // ===== åŸºæœ¬ï¼ˆ6-10ï¼‰ =====
      {
        id: 6, title: 'é€£ç¶šã‚¯ãƒªãƒƒã‚¯', category: 'åŸºæœ¬',
        desc: 'æŒ‡å®šã•ã‚ŒãŸé †ç•ªã§ã‚¯ãƒªãƒƒã‚¯ã—ã‚ˆã†',
        mission: 'ãƒœã‚¿ãƒ³ã‚’1â†’2â†’3ã®é †ã«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„',
        type: 'sequence'
      },
      {
        id: 7, title: 'ã‚­ãƒ¼å…¥åŠ›', category: 'åŸºæœ¬',
        desc: 'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§å…¥åŠ›ã—ã‚ˆã†',
        mission: 'Enterã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„',
        type: 'keyboard'
      },
      {
        id: 8, title: 'ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œé¸æŠ', category: 'åŸºæœ¬',
        desc: 'ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ç‰¹å®šã®è¡Œã‚’é¸æŠã—ã‚ˆã†',
        mission: 'ã€Œã‚Šã‚“ã”ã€ã®è¡Œã®ã€Œé¸æŠã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„',
        type: 'table', answer: 'ã‚Šã‚“ã”'
      },
      {
        id: 9, title: 'ã‚¢ãƒ©ãƒ¼ãƒˆç¢ºèª', category: 'åŸºæœ¬',
        desc: 'ã‚¢ãƒ©ãƒ¼ãƒˆã«å¯¾å¿œã—ã‚ˆã†',
        mission: 'ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚¢ãƒ©ãƒ¼ãƒˆã®OKã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„',
        type: 'alert'
      },
      {
        id: 10, title: 'ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°', category: 'åŸºæœ¬',
        desc: 'ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã€ŒOKã€ã‚’é¸ã¼ã†',
        mission: 'ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã€ŒOKã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„',
        type: 'confirm'
      },
      // ===== ä¸­ç´šï¼ˆ11-15ï¼‰ =====
      {
        id: 11, title: 'è¦ç´ å‡ºç¾å¾…ã¡', category: 'ä¸­ç´š',
        desc: 'è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§å¾…ã¨ã†',
        mission: 'ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼ˆ3ç§’å¾Œï¼‰',
        type: 'wait'
      },
      {
        id: 12, title: 'å‹•çš„è¦ç´ ã‚¯ãƒªãƒƒã‚¯', category: 'ä¸­ç´š',
        desc: 'å‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹è¦ç´ ã‚’æ“ä½œã—ã‚ˆã†',
        mission: 'ã€Œè¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€å‡ºç¾ã—ãŸã€Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯',
        type: 'dynamic'
      },
      {
        id: 13, title: 'ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³', category: 'ä¸­ç´š',
        desc: 'ãƒšãƒ¼ã‚¸ã‚’ç§»å‹•ã—ã¦ç›®çš„ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã¤ã‘ã‚ˆã†',
        mission: '2ãƒšãƒ¼ã‚¸ç›®ã«ç§»å‹•ã—ã¦ã€Œã‚ªãƒ¬ãƒ³ã‚¸ã€ã‚’é¸æŠã—ã¦ãã ã•ã„',
        type: 'pagination', answer: 'ã‚ªãƒ¬ãƒ³ã‚¸'
      },
      {
        id: 14, title: 'ãƒ•ã‚©ãƒ¼ãƒ è¤‡åˆå…¥åŠ›', category: 'ä¸­ç´š',
        desc: 'è¤‡æ•°ã®é …ç›®ã‚’æ­£ã—ãå…¥åŠ›ã—ã‚ˆã†',
        mission: 'åå‰ã€ãƒ¡ãƒ¼ãƒ«ã€é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦é€ä¿¡',
        type: 'form-multi'
      },
      {
        id: 15, title: 'ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—', category: 'ä¸­ç´š',
        desc: 'è¦ç´ ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ç§»å‹•ã—ã‚ˆã†',
        mission: 'é’ã„ãƒœãƒƒã‚¯ã‚¹ã‚’ç·‘ã®ã‚¨ãƒªã‚¢ã«ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„',
        type: 'drag-drop'
      },
      // ===== ä¸Šç´šï¼ˆ16-20ï¼‰ =====
      {
        id: 16, title: 'iframeå†…æ“ä½œ', category: 'ä¸Šç´š',
        desc: 'iframeå†…ã®è¦ç´ ã‚’æ“ä½œã—ã‚ˆã†',
        mission: 'iframeå†…ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„',
        type: 'iframe'
      },
      {
        id: 17, title: 'Shadow DOM', category: 'ä¸Šç´š',
        desc: 'Shadow DOMå†…ã®è¦ç´ ã‚’æ“ä½œã—ã‚ˆã†',
        mission: 'Shadow DOMå†…ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„',
        type: 'shadow-dom'
      },
      {
        id: 18, title: 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›', category: 'ä¸Šç´š',
        desc: 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å€¤ã‚’å…¥åŠ›ã—ã‚ˆã†',
        mission: 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã€Œå®Œäº†ã€ã¨å…¥åŠ›ã—ã¦OKã‚’æŠ¼ã—ã¦ãã ã•ã„',
        type: 'prompt', answer: 'å®Œäº†'
      },
      {
        id: 19, title: 'è¤‡åˆæ“ä½œ', category: 'ä¸Šç´š',
        desc: 'è¤‡æ•°ã®æ“ä½œã‚’é€£ç¶šã§è¡ŒãŠã†',
        mission: 'å…¥åŠ›â†’é¸æŠâ†’ãƒã‚§ãƒƒã‚¯â†’ãƒœã‚¿ãƒ³ã®é †ã«æ“ä½œã—ã¦ãã ã•ã„',
        type: 'complex'
      },
      {
        id: 20, title: 'ç·åˆãƒ†ã‚¹ãƒˆ', category: 'æœ€çµ‚',
        desc: 'ã™ã¹ã¦ã®ã‚¹ã‚­ãƒ«ã‚’é§†ä½¿ã—ã¦ã‚¯ãƒªã‚¢ã—ã‚ˆã†',
        mission: '5ã¤ã®èª²é¡Œã‚’é †ç•ªã«ã‚¯ãƒªã‚¢ã—ã¦ãã ã•ã„',
        type: 'final'
      }
    ];

    // ã‚¯ãƒªã‚¢çŠ¶æ…‹ã‚’ç®¡ç†
    let clearedLevels = JSON.parse(localStorage.getItem('rpa-cleared-levels') || '[]');
    let currentLevel = null;

    // ãƒ¬ãƒ™ãƒ«ä¸€è¦§ã‚’æç”»
    function renderLevelGrid() {
      const grid = document.getElementById('level-grid');
      grid.innerHTML = levels.map((level, index) => {
        const isCleared = clearedLevels.includes(level.id);
        const isLocked = index > 0 && !clearedLevels.includes(levels[index - 1].id);
        const isCurrent = !isCleared && !isLocked;

        let statusHtml = '';
        if (isCleared) {
          statusHtml = '<span class="cleared-text">âœ… ã‚¯ãƒªã‚¢æ¸ˆã¿</span><span class="stars">â­â­â­</span>';
        } else if (isLocked) {
          statusHtml = '<span class="locked-text">ğŸ”’ å‰ã®ãƒ¬ãƒ™ãƒ«ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãã ã•ã„</span>';
        } else {
          statusHtml = '<span style="color: var(--primary);">â–¶ æŒ‘æˆ¦å¯èƒ½</span>';
        }

        return `
          <div class="level-card ${isCleared ? 'cleared' : ''} ${isLocked ? 'locked' : ''} ${isCurrent ? 'current' : ''}"
               onclick="${isLocked ? '' : `startLevel(${level.id})`}">
            <div class="level-number">${level.id}</div>
            <div class="level-title">${level.title}</div>
            <div class="level-desc">${level.desc}</div>
            <div class="level-status">${statusHtml}</div>
          </div>
        `;
      }).join('');

      // é€²æ—ãƒãƒ¼ã‚’æ›´æ–°
      const progress = (clearedLevels.length / levels.length) * 100;
      document.getElementById('total-progress').style.width = progress + '%';
      document.getElementById('total-progress').textContent = Math.round(progress) + '%';
    }

    // ãƒ¬ãƒ™ãƒ«ã‚’é–‹å§‹
    function startLevel(levelId) {
      var level = levels.find(function(l) { return l.id === levelId; });
      if (!level) return;

      currentLevel = level;
      sequenceProgress = 0;
      ãƒ­ã‚°ã‚’è¿½åŠ ('level-log', 'ãƒ¬ãƒ™ãƒ«' + level.id + 'ã€Œ' + level.title + 'ã€ã‚’é–‹å§‹');

      var arena = document.getElementById('level-arena');
      arena.innerHTML = '<div class="level-header"><h2><span class="level-badge">Lv.' + level.id + '</span> ' + level.title + ' <span style="font-size:0.8rem;color:var(--secondary);">[' + level.category + ']</span></h2><button class="btn btn-secondary" onclick="renderLevelGrid(); renderSidebar(); resetArena();">æˆ»ã‚‹</button></div><div class="mission-box"><h3>ğŸ“‹ ãƒŸãƒƒã‚·ãƒ§ãƒ³</h3><p>' + level.mission + '</p></div><div class="level-content" id="level-content">' + getLevelContent(level) + '</div>';

      // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
      if (level.type === 'pagination') {
        setTimeout(function() { changePage(1); }, 100);
      }
    }

    // ãƒ¬ãƒ™ãƒ«ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆ
    function getLevelContent(level) {
      switch (level.type) {
        case 'click':
          return '<div style="text-align: center; padding: 40px;"><button class="btn btn-primary" style="font-size: 1.5rem; padding: 20px 60px;" onclick="checkAnswer(\'click\')">ã‚¯ãƒªãƒƒã‚¯ï¼</button></div>';

        case 'input':
          return '<div style="max-width: 400px; margin: 0 auto; padding: 40px;"><div class="form-group"><label>ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›:</label><input type="text" id="level-input" placeholder="ã“ã“ã«å…¥åŠ›..."></div><button class="btn btn-primary" onclick="checkAnswer(\'input\')">ç¢ºèª</button></div>';

        case 'select':
          return '<div style="max-width: 400px; margin: 0 auto; padding: 40px;"><div class="form-group"><label>éƒ½é“åºœçœŒã‚’é¸æŠ:</label><select id="level-select"><option value="">é¸æŠã—ã¦ãã ã•ã„</option><option value="hokkaido">åŒ—æµ·é“</option><option value="tokyo">æ±äº¬éƒ½</option><option value="osaka">å¤§é˜ªåºœ</option><option value="fukuoka">ç¦å²¡çœŒ</option></select></div><button class="btn btn-primary" onclick="checkAnswer(\'select\')">ç¢ºèª</button></div>';

        case 'checkbox':
          return '<div style="max-width: 400px; margin: 0 auto; padding: 40px;"><div class="form-group"><label style="display: flex; align-items: center; gap: 12px; cursor: pointer;"><input type="checkbox" id="level-checkbox" style="width: 24px; height: 24px;"><span style="font-size: 1.1rem;">åŒæ„ã™ã‚‹</span></label></div><button class="btn btn-primary" onclick="checkAnswer(\'checkbox\')">ç¢ºèª</button></div>';

        case 'radio':
          return '<div style="max-width: 400px; margin: 0 auto; padding: 40px;"><div class="form-group"><label>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é¸æŠ:</label><div class="radio-group" style="margin-top: 12px;"><label style="display: block; margin: 8px 0; cursor: pointer;"><input type="radio" name="level-radio" value="a"> ã‚ªãƒ—ã‚·ãƒ§ãƒ³A</label><label style="display: block; margin: 8px 0; cursor: pointer;"><input type="radio" name="level-radio" value="b"> ã‚ªãƒ—ã‚·ãƒ§ãƒ³B</label><label style="display: block; margin: 8px 0; cursor: pointer;"><input type="radio" name="level-radio" value="c"> ã‚ªãƒ—ã‚·ãƒ§ãƒ³C</label></div></div><button class="btn btn-primary" onclick="checkAnswer(\'radio\')">ç¢ºèª</button></div>';

        case 'sequence':
          return '<div style="text-align: center; padding: 40px;"><p style="margin-bottom: 20px;">é€²æ—: <span id="seq-progress">0</span>/3</p><div style="display: flex; gap: 16px; justify-content: center;"><button class="btn btn-secondary" style="font-size: 1.3rem; padding: 15px 30px;" onclick="checkSequence(1)" id="seq-btn-1">1</button><button class="btn btn-secondary" style="font-size: 1.3rem; padding: 15px 30px;" onclick="checkSequence(2)" id="seq-btn-2">2</button><button class="btn btn-secondary" style="font-size: 1.3rem; padding: 15px 30px;" onclick="checkSequence(3)" id="seq-btn-3">3</button></div></div>';

        case 'keyboard':
          setTimeout(function() {
            var input = document.getElementById('keyboard-input');
            if (input) {
              input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') { checkAnswer('keyboard'); }
              });
            }
          }, 100);
          return '<div style="text-align: center; padding: 40px;"><p style="margin-bottom: 20px;">ä¸‹ã®å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‹ã‚‰Enterã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„</p><input type="text" id="keyboard-input" style="padding: 12px; font-size: 1rem; width: 300px;" placeholder="ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦Enter"></div>';

        case 'table':
          return '<div class="table-container"><table><thead><tr><th>ID</th><th>å•†å“å</th><th>æ“ä½œ</th></tr></thead><tbody><tr><td>001</td><td>ã‚Šã‚“ã”</td><td><button class="btn btn-primary" onclick="checkAnswer(\'table\', \'ã‚Šã‚“ã”\')">é¸æŠ</button></td></tr><tr><td>002</td><td>ã¿ã‹ã‚“</td><td><button class="btn btn-secondary" onclick="checkAnswer(\'table\', \'ã¿ã‹ã‚“\')">é¸æŠ</button></td></tr><tr><td>003</td><td>ã¶ã©ã†</td><td><button class="btn btn-secondary" onclick="checkAnswer(\'table\', \'ã¶ã©ã†\')">é¸æŠ</button></td></tr></tbody></table></div>';

        case 'alert':
          return '<div style="text-align: center; padding: 40px;"><p style="margin-bottom: 20px;">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚OKã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p><button class="btn btn-primary" style="font-size: 1.2rem;" onclick="showAlertChallenge()">ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¡¨ç¤º</button></div>';

        case 'confirm':
          return '<div style="text-align: center; padding: 40px;"><p style="margin-bottom: 20px;">ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§ã€ŒOKã€ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p><button class="btn btn-primary" style="font-size: 1.2rem;" onclick="showConfirmChallenge()">ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º</button></div>';

        case 'wait':
          setTimeout(function() {
            var container = document.getElementById('wait-btn-container');
            if (container) { container.innerHTML = '<button class="btn btn-success" style="font-size: 1.2rem;" onclick="checkAnswer(\'wait\')">ä»Šã ï¼ã‚¯ãƒªãƒƒã‚¯ï¼</button>'; }
          }, 3000);
          return '<div style="text-align: center; padding: 40px;"><p style="margin-bottom: 20px;">ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§å¾…ã£ã¦ãã ã•ã„...</p><div id="wait-btn-container"><div class="spinner"></div></div></div>';

        case 'dynamic':
          return '<div style="text-align: center; padding: 40px;"><p style="margin-bottom: 20px;">ã€Œè¿½åŠ ã€ã‚’æŠ¼ã™ã¨æ–°ã—ã„ãƒœã‚¿ãƒ³ãŒå‡ºç¾ã—ã¾ã™</p><button class="btn btn-primary" onclick="addDynamicTarget()">è¿½åŠ </button><div id="dynamic-container" style="margin-top: 30px;"></div></div>';

        case 'pagination':
          paginationPage = 1;
          return '<div style="padding: 20px;"><div id="pagination-table"></div><div style="text-align: center; margin-top: 16px;"><button class="btn btn-secondary" onclick="changePage(1)" id="page-btn-1">1</button> <button class="btn btn-secondary" onclick="changePage(2)" id="page-btn-2">2</button></div></div>';

        case 'form-multi':
          return '<div style="max-width: 400px; margin: 0 auto; padding: 20px;"><div class="form-group"><label>åå‰:</label><input type="text" id="multi-name" placeholder="åå‰ã‚’å…¥åŠ›"></div><div class="form-group"><label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</label><input type="email" id="multi-email" placeholder="example@test.com"></div><div class="form-group"><label>é›»è©±ç•ªå·:</label><input type="tel" id="multi-phone" placeholder="090-1234-5678"></div><button class="btn btn-primary" onclick="checkAnswer(\'form-multi\')">é€ä¿¡</button></div>';

        case 'drag-drop':
          setTimeout(initDragDrop, 100);
          return '<div style="padding: 40px;"><div style="display: flex; gap: 60px; justify-content: center; align-items: center;"><div id="drag-source" draggable="true" style="width: 80px; height: 80px; background: var(--primary); border-radius: 8px; cursor: grab; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">ãƒ‰ãƒ©ãƒƒã‚°</div><div id="drop-target" style="width: 150px; height: 150px; border: 3px dashed var(--success); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--secondary);">ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—</div></div></div>';

        case 'iframe':
          return '<div style="padding: 20px; text-align: center;"><p style="margin-bottom: 16px;">iframeå†…ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„</p><iframe id="level-iframe" srcdoc="<html><body style=\'text-align:center;padding:40px;font-family:sans-serif;\'><button onclick=\'parent.checkAnswer(\"iframe\")\' style=\'padding:16px 32px;font-size:1.2rem;background:#2563eb;color:white;border:none;border-radius:8px;cursor:pointer;\'>iframeå†…ãƒœã‚¿ãƒ³</button></body></html>" style="width: 100%; height: 200px; border: 2px solid var(--border); border-radius: 8px;"></iframe></div>';

        case 'shadow-dom':
          setTimeout(initShadowDOM, 100);
          return '<div style="padding: 40px; text-align: center;"><p style="margin-bottom: 20px;">Shadow DOMå†…ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„</p><div id="shadow-host"></div></div>';

        case 'prompt':
          return '<div style="text-align: center; padding: 40px;"><p style="margin-bottom: 20px;">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã€Œå®Œäº†ã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„</p><button class="btn btn-primary" style="font-size: 1.2rem;" onclick="showPromptChallenge()">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤º</button></div>';

        case 'complex':
          return '<div style="max-width: 500px; margin: 0 auto; padding: 20px;"><div class="form-group"><label>1. ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›:</label><input type="text" id="complex-input" placeholder="ä½•ã‹å…¥åŠ›"></div><div class="form-group"><label>2. é¸æŠ:</label><select id="complex-select"><option value="">é¸æŠã—ã¦ãã ã•ã„</option><option value="ok">OK</option></select></div><div class="form-group"><label style="display: flex; align-items: center; gap: 12px; cursor: pointer;"><input type="checkbox" id="complex-check"><span>3. ç¢ºèª</span></label></div><button class="btn btn-primary" onclick="checkAnswer(\'complex\')">4. é€ä¿¡</button></div>';

        case 'final':
          finalStep = 0;
          return '<div style="padding: 20px;"><div id="final-challenge" style="text-align: center;"><p>5ã¤ã®èª²é¡Œã‚’ã‚¯ãƒªã‚¢ã—ã¦ãã ã•ã„</p><p style="margin: 20px 0;">é€²æ—: <span id="final-progress">0</span>/5</p><button class="btn btn-primary" onclick="startFinalStep()">é–‹å§‹</button></div></div>';

        default:
          return '<p>Coming soon...</p>';
      }
    }

    // å›ç­”ã‚’ãƒã‚§ãƒƒã‚¯
    let sequenceProgress = 0;
    let paginationPage = 1;
    let finalStep = 0;

    function checkAnswer(type, extra) {
      let success = false;

      switch (type) {
        case 'click':
        case 'keyboard':
        case 'wait':
        case 'iframe':
        case 'shadow-dom':
        case 'dynamic':
          success = true;
          break;

        case 'input':
          var inputVal = document.getElementById('level-input');
          success = inputVal && inputVal.value.toUpperCase() === currentLevel.answer;
          break;

        case 'select':
          var selectVal = document.getElementById('level-select');
          success = selectVal && selectVal.value === currentLevel.answer;
          break;

        case 'checkbox':
          var cb = document.getElementById('level-checkbox');
          success = cb && cb.checked;
          break;

        case 'radio':
          var radioEl = document.querySelector('input[name="level-radio"]:checked');
          success = radioEl && radioEl.value === currentLevel.answer;
          break;

        case 'table':
          success = extra === currentLevel.answer;
          break;

        case 'pagination':
          success = extra === currentLevel.answer;
          break;

        case 'form-multi':
          var mName = document.getElementById('multi-name');
          var mEmail = document.getElementById('multi-email');
          var mPhone = document.getElementById('multi-phone');
          success = mName && mName.value.length > 0 && mEmail && mEmail.value.includes('@') && mPhone && mPhone.value.length > 5;
          break;

        case 'complex':
          var cInput = document.getElementById('complex-input');
          var cSelect = document.getElementById('complex-select');
          var cCheck = document.getElementById('complex-check');
          success = cInput && cInput.value.length > 0 && cSelect && cSelect.value && cCheck && cCheck.checked;
          break;

        case 'alert':
        case 'confirm':
        case 'prompt':
          success = true;
          break;

        case 'final':
          success = true;
          break;
      }

      if (success) {
        clearLevel();
      } else {
        ãƒ­ã‚°ã‚’è¿½åŠ ('level-log', 'âŒ æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ãã ã•ã„ã€‚');
        alert('æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ãã ã•ã„ã€‚');
      }
    }

    function checkSequence(num) {
      var expected = sequenceProgress + 1;
      if (num === expected) {
        sequenceProgress++;
        document.getElementById('seq-progress').textContent = sequenceProgress;
        document.getElementById('seq-btn-' + num).classList.add('btn-success');
        document.getElementById('seq-btn-' + num).classList.remove('btn-secondary');
        if (sequenceProgress === 3) {
          setTimeout(function() { clearLevel(); }, 300);
        }
      } else {
        sequenceProgress = 0;
        document.getElementById('seq-progress').textContent = '0';
        [1, 2, 3].forEach(function(n) {
          document.getElementById('seq-btn-' + n).classList.remove('btn-success');
          document.getElementById('seq-btn-' + n).classList.add('btn-secondary');
        });
        ãƒ­ã‚°ã‚’è¿½åŠ ('level-log', 'âŒ é †ç•ªãŒé•ã„ã¾ã™ã€‚1ã‹ã‚‰ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚');
      }
    }

    // ã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒ£ãƒ¬ãƒ³ã‚¸
    function showAlertChallenge() {
      alert('ã“ã‚Œã¯ã‚¢ãƒ©ãƒ¼ãƒˆã§ã™ã€‚OKã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚');
      checkAnswer('alert');
    }

    // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãƒãƒ£ãƒ¬ãƒ³ã‚¸
    function showConfirmChallenge() {
      var result = confirm('OKã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’æŠ¼ã™ã¨å¤±æ•—ã§ã™ã€‚');
      if (result) {
        checkAnswer('confirm');
      } else {
        ãƒ­ã‚°ã‚’è¿½åŠ ('level-log', 'âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãŒæŠ¼ã•ã‚Œã¾ã—ãŸã€‚');
      }
    }

    // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒãƒ£ãƒ¬ãƒ³ã‚¸
    function showPromptChallenge() {
      var result = prompt('ã€Œå®Œäº†ã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„:');
      if (result === currentLevel.answer) {
        checkAnswer('prompt');
      } else {
        ãƒ­ã‚°ã‚’è¿½åŠ ('level-log', 'âŒ å…¥åŠ›ãŒé•ã„ã¾ã™ã€‚ã€Œå®Œäº†ã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        alert('å…¥åŠ›ãŒé•ã„ã¾ã™ã€‚ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ãã ã•ã„ã€‚');
      }
    }

    // å‹•çš„è¦ç´ è¿½åŠ 
    function addDynamicTarget() {
      var container = document.getElementById('dynamic-container');
      if (container) {
        container.innerHTML = '<button class="btn btn-success" style="font-size: 1.2rem;" onclick="checkAnswer(\'dynamic\')">ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ</button>';
      }
    }

    // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
    var paginationData = {
      1: [{ name: 'ã‚Šã‚“ã”' }, { name: 'ã¿ã‹ã‚“' }, { name: 'ãƒãƒŠãƒŠ' }],
      2: [{ name: 'ã¶ã©ã†' }, { name: 'ã‚ªãƒ¬ãƒ³ã‚¸' }, { name: 'ã„ã¡ã”' }]
    };

    function changePage(page) {
      paginationPage = page;
      document.getElementById('page-btn-1').classList.toggle('btn-primary', page === 1);
      document.getElementById('page-btn-1').classList.toggle('btn-secondary', page !== 1);
      document.getElementById('page-btn-2').classList.toggle('btn-primary', page === 2);
      document.getElementById('page-btn-2').classList.toggle('btn-secondary', page !== 2);
      renderPaginationTable();
    }

    function renderPaginationTable() {
      var data = paginationData[paginationPage];
      var html = '<table><thead><tr><th>No</th><th>å•†å“å</th><th>æ“ä½œ</th></tr></thead><tbody>';
      data.forEach(function(item, i) {
        html += '<tr><td>' + (i + 1) + '</td><td>' + item.name + '</td><td><button class="btn btn-secondary" onclick="checkAnswer(\'pagination\', \'' + item.name + '\')">é¸æŠ</button></td></tr>';
      });
      html += '</tbody></table>';
      document.getElementById('pagination-table').innerHTML = html;
    }

    // ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—åˆæœŸåŒ–
    function initDragDrop() {
      var source = document.getElementById('drag-source');
      var target = document.getElementById('drop-target');
      if (!source || !target) return;

      source.addEventListener('dragstart', function(e) {
        e.dataTransfer.setData('text', 'drag');
        source.style.opacity = '0.5';
      });
      source.addEventListener('dragend', function() {
        source.style.opacity = '1';
      });
      target.addEventListener('dragover', function(e) {
        e.preventDefault();
        target.style.borderColor = '#059669';
        target.style.background = 'rgba(16, 185, 129, 0.1)';
      });
      target.addEventListener('dragleave', function() {
        target.style.borderColor = 'var(--success)';
        target.style.background = 'transparent';
      });
      target.addEventListener('drop', function(e) {
        e.preventDefault();
        target.innerHTML = '<div style="color: var(--success); font-weight: bold;">ãƒ‰ãƒ­ãƒƒãƒ—æˆåŠŸï¼</div>';
        setTimeout(function() { checkAnswer('drag-drop'); }, 500);
      });
    }

    // Shadow DOMåˆæœŸåŒ–
    function initShadowDOM() {
      var host = document.getElementById('shadow-host');
      if (!host || host.shadowRoot) return;
      var shadow = host.attachShadow({ mode: 'open' });
      shadow.innerHTML = '<style>button { padding: 16px 32px; font-size: 1.2rem; background: #7c3aed; color: white; border: none; border-radius: 8px; cursor: pointer; } button:hover { background: #6d28d9; }</style><button id="shadow-btn">Shadow DOMãƒœã‚¿ãƒ³</button>';
      shadow.getElementById('shadow-btn').addEventListener('click', function() {
        checkAnswer('shadow-dom');
      });
    }

    // ç·åˆãƒ†ã‚¹ãƒˆ
    var finalSteps = ['click', 'input', 'select', 'checkbox', 'confirm'];
    function startFinalStep() {
      var container = document.getElementById('final-challenge');
      if (finalStep >= finalSteps.length) {
        checkAnswer('final');
        return;
      }
      var step = finalSteps[finalStep];
      var html = '<p>èª²é¡Œ ' + (finalStep + 1) + '/5</p>';
      switch (step) {
        case 'click':
          html += '<button class="btn btn-primary" onclick="completeFinalStep()">ã‚¯ãƒªãƒƒã‚¯</button>';
          break;
        case 'input':
          html += '<input type="text" id="final-input" placeholder="ä½•ã‹å…¥åŠ›"><button class="btn btn-primary" onclick="checkFinalInput()">ç¢ºèª</button>';
          break;
        case 'select':
          html += '<select id="final-sel"><option value="">é¸æŠ</option><option value="ok">OK</option></select><button class="btn btn-primary" onclick="checkFinalSelect()">ç¢ºèª</button>';
          break;
        case 'checkbox':
          html += '<label><input type="checkbox" id="final-cb"> ãƒã‚§ãƒƒã‚¯</label><button class="btn btn-primary" onclick="checkFinalCheckbox()">ç¢ºèª</button>';
          break;
        case 'confirm':
          html += '<button class="btn btn-primary" onclick="checkFinalConfirm()">ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°</button>';
          break;
      }
      container.innerHTML = html;
    }
    function completeFinalStep() { finalStep++; document.getElementById('final-progress').textContent = finalStep; startFinalStep(); }
    function checkFinalInput() { var v = document.getElementById('final-input'); if (v && v.value.length > 0) completeFinalStep(); else alert('å…¥åŠ›ã—ã¦ãã ã•ã„'); }
    function checkFinalSelect() { var v = document.getElementById('final-sel'); if (v && v.value) completeFinalStep(); else alert('é¸æŠã—ã¦ãã ã•ã„'); }
    function checkFinalCheckbox() { var v = document.getElementById('final-cb'); if (v && v.checked) completeFinalStep(); else alert('ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„'); }
    function checkFinalConfirm() { if (confirm('OKã‚’æŠ¼ã—ã¦ãã ã•ã„')) completeFinalStep(); }

    // ãƒ¬ãƒ™ãƒ«ã‚¯ãƒªã‚¢
    function clearLevel() {
      if (!clearedLevels.includes(currentLevel.id)) {
        clearedLevels.push(currentLevel.id);
        localStorage.setItem('rpa-cleared-levels', JSON.stringify(clearedLevels));
      }

      ãƒ­ã‚°ã‚’è¿½åŠ ('level-log', `ğŸ‰ ãƒ¬ãƒ™ãƒ«${currentLevel.id}ã€Œ${currentLevel.title}ã€ã‚¯ãƒªã‚¢ï¼`);

      const arena = document.getElementById('level-arena');
      arena.innerHTML = `
        <div class="celebration">
          <div class="stars">â­â­â­</div>
          <h2>ğŸ‰ ãƒ¬ãƒ™ãƒ«${currentLevel.id} ã‚¯ãƒªã‚¢ï¼</h2>
          <p style="font-size: 1.2rem; margin-bottom: 24px;">${currentLevel.title}ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ãŸï¼</p>
          <div class="level-actions">
            ${currentLevel.id < levels.length
              ? `<button class="btn btn-primary" onclick="startLevel(${currentLevel.id + 1})">æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¸ â†’</button>`
              : `<button class="btn btn-success" onclick="alert('ãŠã‚ã§ã¨ã†ï¼å…¨ãƒ¬ãƒ™ãƒ«ã‚¯ãƒªã‚¢ï¼')">ğŸ† å…¨ã‚¯ãƒªã‚¢ï¼</button>`
            }
            <button class="btn btn-secondary" onclick="renderLevelGrid(); renderSidebar(); resetArena();">ãƒ¬ãƒ™ãƒ«é¸æŠã«æˆ»ã‚‹</button>
          </div>
        </div>
      `;

      renderLevelGrid();
      renderSidebar();
    }

    // ã‚¢ãƒªãƒ¼ãƒŠã‚’ãƒªã‚»ãƒƒãƒˆ
    function resetArena() {
      sequenceProgress = 0;
      document.getElementById('level-arena').innerHTML = `
        <div style="text-align: center; padding: 60px; color: var(--secondary);">
          <p style="font-size: 1.2rem;">ä¸Šã‹ã‚‰ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
        </div>
      `;
    }

    // é€²æ—ãƒªã‚»ãƒƒãƒˆ
    function resetProgress() {
      if (confirm('é€²æ—ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
        clearedLevels = [];
        localStorage.removeItem('rpa-cleared-levels');
        renderLevelGrid();
        renderSidebar();
        resetArena();
        ãƒ­ã‚°ã‚’è¿½åŠ ('level-log', 'é€²æ—ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸ');
      }
    }

    // ã‚µã‚¤ãƒ‰ãƒãƒ¼æç”»
    function renderSidebar() {
      const sidebar = document.getElementById('level-sidebar');
      if (!sidebar) return;

      const clearedCount = clearedLevels.length;
      const totalLevels = levels.length;
      const percent = Math.round((clearedCount / totalLevels) * 100);

      let html = '';

      // ãƒ¬ãƒ™ãƒ«ãƒ‰ãƒƒãƒˆï¼ˆ1ã€œ10ï¼‰
      levels.forEach((level) => {
        const isCleared = clearedLevels.includes(level.id);
        const isLocked = level.id > 1 && !clearedLevels.includes(level.id - 1);

        let dotClass = 'level-dot';
        if (isCleared) {
          dotClass += ' cleared';
        } else if (isLocked) {
          dotClass += ' locked';
        } else {
          dotClass += ' current';
        }

        const icon = isCleared ? 'âœ“' : level.id;
        const clickHandler = isLocked ? '' : 'startLevel(' + level.id + ')';

        html += '<div class="' + dotClass + '" onclick="' + clickHandler + '" title="Lv.' + level.id + ': ' + level.title + '">' + icon + '</div>';
      });

      // é€²æ—ãƒãƒ¼
      html += '<div class="level-sidebar-progress"><div class="level-sidebar-progress-fill" style="height: ' + percent + '%"></div></div>';
      html += '<div class="level-sidebar-percent">' + percent + '%</div>';

      sidebar.innerHTML = html;
    }

    // åˆæœŸåŒ–
    renderLevelGrid();
    renderSidebar();
  </script>
</body>
</html>
